{% extends "layout.html" %}
{% block title %}Diabetes — Multi Disease Predictor{% endblock %}

{% block content %}
<h2 class="page-title">Diabetes Prediction</h2>

<!-- Predict button (top) -->
<button class="btn-primary" type="button"
        onclick="validateFormAndSubmit('diabetesForm','diabetesError')"
        style="margin-bottom:12px;">
    Predict
</button>

<!-- Error box (hidden by default) -->
<div id="diabetesError" style="display:none; background:#ffeef0; border-left:4px solid #e11d48; padding:12px; margin-bottom:12px; border-radius:8px;">
  <strong style="color:#b91c1c">Error:</strong>
  <span style="margin-left:8px;color:#7f1d1d">Please fill all required fields before predicting.</span>
</div>

<!-- Result box (if server returned a result) -->
{% if diabetes_result %}
<div class="result-box {{ 'positive' if diabetes_result=='Positive' else 'negative' }}" style="margin-bottom:18px;">
  <h3>{{ diabetes_result }}</h3>
  <p>{{ diabetes_message }}</p>
  <a class="btn-secondary" href="{{ url_for('diabetes_precaution') }}?res={{ diabetes_result }}">More details →</a>
</div>
{% endif %}

<!-- FORM BELOW -->
<form id="diabetesForm" action="{{ url_for('predictdiabetes') }}" method="POST" class="form-card">
  <div class="two-grid" style="gap:15px 25px;">
    <label>Pregnancies
      <input name="pregnancies" required type="number" placeholder="e.g. 0–15">
    </label>

    <label>Glucose (mg/dL)
      <input name="glucose" required type="number" placeholder="e.g. 50–200">
    </label>

    <label>Blood Pressure (mm Hg)
      <input name="bloodpressure" required type="number" placeholder="e.g. 30–150">
    </label>

    <label>Skin Thickness (mm)
      <input name="skinthickness" required type="number" placeholder="e.g. 5–80">
    </label>

    <label>Insulin (IU/mL)
      <input name="insulin" required type="number" placeholder="e.g. 15–300">
    </label>

    <label>BMI
      <input name="bmi" required type="number" step="any" placeholder="e.g. 10–60">
    </label>

    <label>Diabetes Pedigree Function
      <input name="dpf" required type="number" step="any" placeholder="e.g. 0.0–2.5">
    </label>

    <label>Age (years)
      <input name="age" required type="number" placeholder="e.g. 18–80">
    </label>
  </div>

  <!-- hidden submit (used by JS) -->
  <button type="submit" style="display:none;"></button>
</form>

{% include 'chatbot.html' %}

<!-- Validation script -->
<script>
function validateFormAndSubmit(formId, errorId) {
  const form = document.getElementById(formId);
  const inputs = form.querySelectorAll('input[required]');
  let missing = false;
  for (let i=0; i<inputs.length; i++) {
    const v = inputs[i].value;
    if (!v || !v.toString().trim()) { missing = true; break; }
  }
  const err = document.getElementById(errorId);
  if (missing) {
    err.style.display = 'block';
    // scroll to error box (nice UX)
    err.scrollIntoView({behavior:'smooth', block:'center'});
    return false;
  } else {
    err.style.display = 'none';
    form.submit();
  }
}
</script>
{% endblock %}
