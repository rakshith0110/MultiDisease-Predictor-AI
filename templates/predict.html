{% extends "layout.html" %}
{% block title %}Models — AI Disease Prediction{% endblock %}
{% block content %}

<section class="predict-page-wrapper" style="padding:24px 24px 48px;">

  <div class="card predict-wrap" style="padding:14px 18px; align-items:flex-start; gap:20px;">

    <!-- LEFT: models list + heading -->
    <aside class="models" aria-label="Models list" style="min-width:260px;">
      <div class="models-header" style="margin-bottom:12px;">
        <h2 style="margin:0 0 6px 0; font-size:1.6rem;">Select a model</h2>
        <p style="margin:0;color:var(--muted);font-size:0.95rem;">Click a model on the left to load its input form.</p>
      </div>

      <div class="models-list">
        <div class="model-item active" data-model="diabetes" tabindex="0">
          <i class="fas fa-clipboard-check" style="color:var(--accent);margin-right:12px;"></i>
          <div><strong>Diabetes</strong><br><small style="color:var(--muted);">Blood sugar related</small></div>
        </div>

        <div class="model-item" data-model="heart" tabindex="0">
          <i class="fas fa-heart" style="color:var(--accent);margin-right:12px;"></i>
          <div><strong>Heart Disease</strong><br><small style="color:var(--muted);">Cardiac risk</small></div>
        </div>

        <div class="model-item" data-model="parkinsons" tabindex="0">
          <i class="fas fa-brain" style="color:var(--accent);margin-right:12px;"></i>
          <div><strong>Parkinson's</strong><br><small style="color:var(--muted);">Neurological</small></div>
        </div>
      </div>
    </aside>

    <!-- RIGHT: dynamic panel + forms (scrollable) -->
    <div class="form-area" style="flex:1; min-width:420px;">

      <!-- header panel (title + smaller illustration) -->
      <div id="model-panel" class="card panel-small" style="padding:12px 14px; display:flex; gap:12px; align-items:center; justify-content:space-between;">
        <div style="flex:1; min-width:200px;">
          <h3 id="model-title" style="margin:0;font-size:1.25rem;">Diabetes Prediction</h3>
          <p id="model-sub" style="margin:6px 0 0;color:var(--muted);font-size:0.95rem;">Fill the inputs and click Predict. Result appears below.</p>
        </div>

        <div style="width:120px; flex:0 0 120px; display:flex; align-items:center; justify-content:center;">
          <img src="{{ url_for('static', filename='image/diagnostic.png') }}" alt="Diagnostic" class="model-illustration small">
        </div>
      </div>

      <!-- the scrollable form container -->
      <div id="model-form-wrap" class="form-scroll-area" style="margin-top:16px;">

        <!-- ---------- DIABETES FORM (8 fields) ---------- -->
        <form id="form-diabetes" class="model-form card" method="POST" action="{{ url_for('predictdiabetes') }}">
          <div class="form-grid" style="display:grid; grid-template-columns: repeat(2,1fr); gap:14px 18px;">
            <div>
              <label>Pregnancies</label>
              <input name="pregnancies" type="text" placeholder="e.g. 2" required>
            </div>
            <div>
              <label>Glucose</label>
              <input name="glucose" type="text" placeholder="e.g. 120" required>
            </div>
            <div>
              <label>Blood Pressure</label>
              <input name="bloodpressure" type="text" placeholder="e.g. 70" required>
            </div>
            <div>
              <label>Skin Thickness</label>
              <input name="skinthickness" type="text" placeholder="e.g. 20" required>
            </div>
            <div>
              <label>Insulin</label>
              <input name="insulin" type="text" placeholder="e.g. 85" required>
            </div>
            <div>
              <label>BMI</label>
              <input name="bmi" type="text" placeholder="e.g. 26.5" required>
            </div>
            <div>
              <label>Diabetes Pedigree Function</label>
              <input name="dpf" type="text" placeholder="e.g. 0.627" required>
            </div>
            <div>
              <label>Age</label>
              <input name="age" type="text" placeholder="e.g. 33" required>
            </div>
          </div>

          <div style="margin-top:14px;">
            <button class="btn" type="submit">Predict Diabetes</button>
          </div>

          {% if diabetes_result is defined %}
          <div class="result-box" style="margin-top:12px; color:{{ 'green' if diabetes_result=='Negative' else 'red' }};">
            {{ diabetes_result }} — {{ diabetes_message|default('') }}
          </div>
          {% endif %}
        </form>

        <!-- ---------- HEART FORM (13 fields) ---------- -->
        <form id="form-heart" class="model-form card hidden" method="POST" action="{{ url_for('predictheartdisease') }}">
          <div class="form-grid" style="display:grid; grid-template-columns: repeat(2,1fr); gap:14px 18px;">
            <div><label>Age</label><input name="age" required></div>
            <div><label>Sex (0=female,1=male)</label><input name="sex" required></div>
            <div><label>Chest Pain Type (0-3)</label><input name="cp" required></div>
            <div><label>Resting BP</label><input name="trestbps" required></div>
            <div><label>Cholesterol</label><input name="chol" required></div>
            <div><label>Fasting BS (0/1)</label><input name="fbs" required></div>
            <div><label>Resting ECG (0-2)</label><input name="restecg" required></div>
            <div><label>Max Heart Rate</label><input name="thalach" required></div>
            <div><label>Exercise induced angina (0/1)</label><input name="exang" required></div>
            <div><label>Oldpeak</label><input name="oldpeak" required></div>
            <div><label>Slope (0-2)</label><input name="slope" required></div>
            <div><label>Number of major vessels (0-4)</label><input name="ca" required></div>
            <div><label>Thal (0/1/2)</label><input name="thal" required></div>
          </div>

          <div style="margin-top:14px;">
            <button class="btn" type="submit">Predict Heart</button>
          </div>

          {% if heart_result is defined %}
          <div class="result-box" style="margin-top:12px; color:{{ 'green' if heart_result=='Negative' else 'red' }};">
            {{ heart_result }} — {{ heart_message|default('') }}
          </div>
          {% endif %}
        </form>

        <!-- ---------- PARKINSONS FORM (22 fields) ---------- -->
        <form id="form-parkinsons" class="model-form card hidden" method="POST" action="{{ url_for('predictparkinsons') }}">
          <div class="form-grid" style="display:grid; grid-template-columns: repeat(2,1fr); gap:14px 18px;">
            {% for i in range(1,23) %}
            <div>
              <label>Feature {{ i }}</label>
              <input name="f{{ i }}" required>
            </div>
            {% endfor %}
          </div>

          <div style="margin-top:14px;">
            <button class="btn" type="submit">Predict Parkinsons</button>
          </div>

          {% if parkinsons_result is defined %}
          <div class="result-box" style="margin-top:12px; color:{{ 'green' if parkinsons_result=='Negative' else 'red' }};">
            {{ parkinsons_result }} — {{ parkinsons_message|default('') }}
          </div>
          {% endif %}
        </form>

      </div>
    </div>
  </div>
</section>

{% include 'chatbot.html' %}

<!-- Toggle JS: switch models and forms -->
<script>
  (function(){
    const items = document.querySelectorAll('.model-item');
    const forms = {
      diabetes: document.getElementById('form-diabetes'),
      heart: document.getElementById('form-heart'),
      parkinsons: document.getElementById('form-parkinsons')
    };
    const title = document.getElementById('model-title');
    const subtitle = document.getElementById('model-sub');

    function showModel(name){
      items.forEach(it => it.classList.toggle('active', it.dataset.model === name));
      Object.values(forms).forEach(f => f.classList.add('hidden'));
      if (forms[name]) forms[name].classList.remove('hidden');

      if (name === 'diabetes') {
        title.textContent = 'Diabetes Prediction';
        subtitle.textContent = 'Fill the inputs and click Predict. Result appears below.';
      } else if (name === 'heart') {
        title.textContent = 'Heart Prediction';
        subtitle.textContent = 'Fill the inputs and click Predict. Result appears below.';
      } else {
        title.textContent = "Parkinson's Prediction";
        subtitle.textContent = 'Fill the inputs and click Predict. Result appears below.';
      }
      // scroll the right form area to top so user sees the form header
      const wrap = document.querySelector('.form-scroll-area');
      if (wrap) wrap.scrollTop = 0;
    }

    items.forEach(it=>{
      it.addEventListener('click', ()=> showModel(it.dataset.model));
      it.addEventListener('keypress', (e)=>{
        if (e.key === 'Enter' || e.key === ' ') { showModel(it.dataset.model); e.preventDefault(); }
      });
    });

    // show default on load
    showModel('diabetes');
  })();
</script>

<style>
  /* small helpers */
  .hidden { display: none !important; }
  .model-item.active { border-color: var(--accent); background: #e9fff6; box-shadow: 0 6px 18px rgba(0,0,0,0.04); }
  .result-box { padding:12px; border-radius:8px; background:#fff8f8; border:1px solid #f3dede; }
  @media (max-width: 980px){ .models { position: static; } .form-area { max-height:none; } }
</style>

{% endblock %}
